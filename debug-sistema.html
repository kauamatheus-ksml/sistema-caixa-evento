<!DOCTYPE html>
<!-- debug-sistema.html - Script de Debug do CaixaEvent v2.0 -->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Debug CaixaEvent v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .debug-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .debug-header {
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .debug-content {
            padding: 30px;
        }

        .test-section {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .test-header {
            background: #f5f5f5;
            padding: 15px 20px;
            font-weight: bold;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-content {
            padding: 20px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: #4CAF50;
        }

        .status-error {
            background: #F44336;
        }

        .status-warning {
            background: #FF9800;
        }

        .status-loading {
            background: #2196F3;
            animation: pulse 2s infinite;
        }

        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }

        .result-success {
            background: #e8f5e8;
            color: #2e7d2e;
            border-left: 4px solid #4CAF50;
        }

        .result-error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #F44336;
        }

        .result-warning {
            background: #fff3e0;
            color: #f57c00;
            border-left: 4px solid #FF9800;
        }

        .result-info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196F3;
        }

        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-danger {
            background: #F44336;
        }

        .btn-warning {
            background: #FF9800;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            width: 0%;
            transition: width 0.3s ease;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .fix-suggestion {
            background: #f0f8ff;
            border: 1px solid #007acc;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .summary-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .summary-card.success {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .summary-card.error {
            border-color: #F44336;
            background: #ffebee;
        }

        .summary-card.warning {
            border-color: #FF9800;
            background: #fff3e0;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="debug-header">
            <h1>üîß Debug CaixaEvent v2.0</h1>
            <p>Sistema de Diagn√≥stico e Corre√ß√£o Autom√°tica</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Iniciando diagn√≥stico...</p>
        </div>

        <div class="debug-content">
            <!-- Controles Principais -->
            <div class="test-section">
                <div class="test-header">
                    üéÆ Controles de Debug
                </div>
                <div class="test-content">
                    <button class="btn" onclick="iniciarDebugCompleto()">üöÄ Iniciar Debug Completo</button>
                    <button class="btn btn-warning" onclick="testarConexoesBanco()">üóÑÔ∏è Testar MySQL</button>
                    <button class="btn btn-success" onclick="testarFuncionalidades()">‚ö° Testar Funcionalidades</button>
                    <button class="btn btn-danger" onclick="corrigirProblemasAutomaticamente()">üîß Corre√ß√£o Autom√°tica</button>
                </div>
            </div>

            <!-- Teste 1: Verifica√ß√£o de Arquivos -->
            <div class="test-section">
                <div class="test-header">
                    <span class="status-indicator status-loading" id="status-arquivos"></span>
                    üìÅ Verifica√ß√£o de Arquivos
                </div>
                <div class="test-content" id="content-arquivos">
                    <div class="test-result result-info">Aguardando execu√ß√£o do teste...</div>
                </div>
            </div>

            <!-- Teste 2: Configura√ß√£o do Sistema -->
            <div class="test-section">
                <div class="test-header">
                    <span class="status-indicator status-loading" id="status-config"></span>
                    ‚öôÔ∏è Configura√ß√£o do Sistema
                </div>
                <div class="test-content" id="content-config">
                    <div class="test-result result-info">Aguardando execu√ß√£o do teste...</div>
                </div>
            </div>

            <!-- Teste 3: Conectividade MySQL -->
            <div class="test-section">
                <div class="test-header">
                    <span class="status-indicator status-loading" id="status-mysql"></span>
                    üóÑÔ∏è Conectividade MySQL
                </div>
                <div class="test-content" id="content-mysql">
                    <div class="test-result result-info">Aguardando execu√ß√£o do teste...</div>
                </div>
            </div>

            <!-- Teste 4: APIs e Backend -->
            <div class="test-section">
                <div class="test-header">
                    <span class="status-indicator status-loading" id="status-apis"></span>
                    üåê APIs e Backend
                </div>
                <div class="test-content" id="content-apis">
                    <div class="test-result result-info">Aguardando execu√ß√£o do teste...</div>
                </div>
            </div>

            <!-- Teste 5: Funcionalidades Frontend -->
            <div class="test-section">
                <div class="test-header">
                    <span class="status-indicator status-loading" id="status-frontend"></span>
                    üíª Funcionalidades Frontend
                </div>
                <div class="test-content" id="content-frontend">
                    <div class="test-result result-info">Aguardando execu√ß√£o do teste...</div>
                </div>
            </div>

            <!-- Resumo Final -->
            <div class="test-section">
                <div class="test-header">
                    üìä Resumo do Diagn√≥stico
                </div>
                <div class="test-content">
                    <div class="summary-grid" id="summaryGrid">
                        <!-- Preenchido pelo JavaScript -->
                    </div>
                    <div id="recommendations"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de Debug CaixaEvent v2.0
        class DebugCaixaEvent {
            constructor() {
                this.resultados = {};
                this.progresso = 0;
                this.totalTestes = 5;
                this.problemasEncontrados = [];
                this.solucoesAutomaticas = [];
            }

            // Fun√ß√£o principal que executa todos os testes
            async iniciarDebugCompleto() {
                this.atualizarProgresso(0, "Iniciando diagn√≥stico completo...");
                
                try {
                    await this.verificarArquivos();
                    await this.verificarConfiguracao();
                    await this.testarMySQL();
                    await this.testarAPIs();
                    await this.testarFrontend();
                    
                    this.gerarResumo();
                    this.atualizarProgresso(100, "Diagn√≥stico completo finalizado!");
                } catch (error) {
                    console.error('Erro durante debug:', error);
                    this.adicionarResultado('debug-geral', 'error', `Erro geral: ${error.message}`);
                }
            }

            // Teste 1: Verifica√ß√£o de Arquivos Essenciais
            async verificarArquivos() {
                this.atualizarProgresso(20, "Verificando arquivos do sistema...");
                const contentDiv = document.getElementById('content-arquivos');
                const statusDiv = document.getElementById('status-arquivos');
                
                contentDiv.innerHTML = '';
                
                const arquivosEssenciais = [
                    { path: 'css/style.css', name: 'Arquivo CSS principal' },
                    { path: 'js/cartao.js', name: 'Sistema localStorage' },
                    { path: 'js/cartao-mysql.js', name: 'Sistema MySQL' },
                    { path: 'js/main.js', name: 'Dashboard principal' },
                    { path: 'api/config.php', name: 'Configura√ß√£o MySQL' },
                    { path: 'api/cartoes.php', name: 'API de cart√µes' },
                    { path: 'api/produtos.php', name: 'API de produtos' }
                ];

                let arquivosEncontrados = 0;
                let arquivosFaltando = [];

                for (const arquivo of arquivosEssenciais) {
                    try {
                        const response = await fetch(arquivo.path, { method: 'HEAD' });
                        if (response.ok) {
                            this.adicionarResultadoDiv(contentDiv, 'success', `‚úÖ ${arquivo.name} - OK`);
                            arquivosEncontrados++;
                        } else {
                            this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå ${arquivo.name} - N√£o encontrado`);
                            arquivosFaltando.push(arquivo);
                        }
                    } catch (error) {
                        this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå ${arquivo.name} - Erro: ${error.message}`);
                        arquivosFaltando.push(arquivo);
                    }
                }

                // Detectar qual vers√£o est√° sendo usada
                this.detectarVersaoSistema(contentDiv);

                if (arquivosFaltando.length === 0) {
                    statusDiv.className = 'status-indicator status-success';
                    this.resultados.arquivos = { status: 'success', detalhes: 'Todos os arquivos encontrados' };
                } else {
                    statusDiv.className = 'status-indicator status-error';
                    this.resultados.arquivos = { status: 'error', detalhes: `${arquivosFaltando.length} arquivos faltando` };
                    this.problemasEncontrados.push(`Arquivos faltando: ${arquivosFaltando.map(a => a.name).join(', ')}`);
                }
            }

            // Detecta qual vers√£o do sistema est√° sendo usada
            async detectarVersaoSistema(contentDiv) {
                try {
                    const response = await fetch('index.html');
                    const html = await response.text();
                    
                    if (html.includes('cartao-mysql.js')) {
                        this.adicionarResultadoDiv(contentDiv, 'info', 'üîÑ Vers√£o MySQL detectada no index.html');
                        this.versaoDetectada = 'mysql';
                    } else if (html.includes('cartao.js')) {
                        this.adicionarResultadoDiv(contentDiv, 'info', 'üíæ Vers√£o localStorage detectada no index.html');
                        this.versaoDetectada = 'localstorage';
                    } else {
                        this.adicionarResultadoDiv(contentDiv, 'warning', '‚ö†Ô∏è Nenhuma vers√£o do sistema detectada no index.html');
                        this.versaoDetectada = 'indefinida';
                        this.problemasEncontrados.push('Vers√£o do sistema n√£o detectada no index.html');
                    }
                } catch (error) {
                    this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå Erro ao analisar index.html: ${error.message}`);
                }
            }

            // Teste 2: Configura√ß√£o do Sistema
            async verificarConfiguracao() {
                this.atualizarProgresso(40, "Verificando configura√ß√µes...");
                const contentDiv = document.getElementById('content-config');
                const statusDiv = document.getElementById('status-config');
                
                contentDiv.innerHTML = '';
                
                let problemasConfig = 0;

                // Verifica localStorage
                try {
                    localStorage.setItem('teste', 'ok');
                    localStorage.removeItem('teste');
                    this.adicionarResultadoDiv(contentDiv, 'success', '‚úÖ localStorage funcionando');
                } catch (error) {
                    this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå Problema com localStorage: ${error.message}`);
                    problemasConfig++;
                }

                // Verifica se h√° dados existentes
                const dadosExistentes = {
                    cartoes: localStorage.getItem('caixaevent_cartoes'),
                    historico: localStorage.getItem('caixaevent_historico'),
                    produtos: localStorage.getItem('caixaevent_produtos')
                };

                let dadosEncontrados = 0;
                Object.entries(dadosExistentes).forEach(([tipo, dados]) => {
                    if (dados) {
                        this.adicionarResultadoDiv(contentDiv, 'info', `üìÑ Dados ${tipo} encontrados no localStorage`);
                        dadosEncontrados++;
                    }
                });

                if (dadosEncontrados === 0) {
                    this.adicionarResultadoDiv(contentDiv, 'warning', '‚ö†Ô∏è Nenhum dado encontrado no localStorage');
                }

                // Verifica configura√ß√µes de rede
                if (navigator.onLine) {
                    this.adicionarResultadoDiv(contentDiv, 'success', '‚úÖ Conex√£o com internet ativa');
                } else {
                    this.adicionarResultadoDiv(contentDiv, 'warning', '‚ö†Ô∏è Sem conex√£o com internet');
                    problemasConfig++;
                }

                if (problemasConfig === 0) {
                    statusDiv.className = 'status-indicator status-success';
                    this.resultados.config = { status: 'success', detalhes: 'Configura√ß√µes OK' };
                } else {
                    statusDiv.className = 'status-indicator status-warning';
                    this.resultados.config = { status: 'warning', detalhes: `${problemasConfig} problemas encontrados` };
                }
            }

            // Teste 3: Conectividade MySQL
            async testarMySQL() {
                this.atualizarProgresso(60, "Testando conectividade MySQL...");
                const contentDiv = document.getElementById('content-mysql');
                const statusDiv = document.getElementById('status-mysql');
                
                contentDiv.innerHTML = '';

                if (this.versaoDetectada !== 'mysql') {
                    this.adicionarResultadoDiv(contentDiv, 'info', 'üíæ Sistema configurado para localStorage - MySQL n√£o necess√°rio');
                    statusDiv.className = 'status-indicator status-success';
                    this.resultados.mysql = { status: 'success', detalhes: 'MySQL n√£o √© necess√°rio para vers√£o localStorage' };
                    return;
                }

                try {
                    // Testa conex√£o com config.php
                    this.adicionarResultadoDiv(contentDiv, 'info', 'üîÑ Testando config.php...');
                    const configResponse = await fetch('api/config.php');
                    
                    if (configResponse.ok) {
                        const configData = await configResponse.text();
                        this.adicionarResultadoDiv(contentDiv, 'success', '‚úÖ Arquivo config.php acess√≠vel');
                        
                        // Verifica se h√° erro na resposta
                        if (configData.includes('erro') || configData.includes('N√£o foi poss√≠vel conectar')) {
                            this.adicionarResultadoDiv(contentDiv, 'error', '‚ùå Erro de conex√£o MySQL detectado no config.php');
                            this.problemasEncontrados.push('Credenciais MySQL incorretas ou servidor inacess√≠vel');
                            this.solucoesAutomaticas.push('verificar-credenciais-mysql');
                        }
                    } else {
                        this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå config.php inacess√≠vel (${configResponse.status})`);
                        this.problemasEncontrados.push('Arquivo config.php n√£o acess√≠vel');
                    }

                    // Testa APIs
                    const apisParaTestar = ['cartoes.php', 'produtos.php'];
                    for (const api of apisParaTestar) {
                        try {
                            const response = await fetch(`api/${api}?request=teste`);
                            if (response.ok) {
                                this.adicionarResultadoDiv(contentDiv, 'success', `‚úÖ API ${api} respondendo`);
                            } else {
                                this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå API ${api} com erro (${response.status})`);
                            }
                        } catch (error) {
                            this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå Erro ao testar ${api}: ${error.message}`);
                        }
                    }

                    statusDiv.className = 'status-indicator status-success';
                    this.resultados.mysql = { status: 'success', detalhes: 'Conectividade MySQL OK' };

                } catch (error) {
                    this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå Erro geral MySQL: ${error.message}`);
                    statusDiv.className = 'status-indicator status-error';
                    this.resultados.mysql = { status: 'error', detalhes: error.message };
                    this.problemasEncontrados.push(`Erro MySQL: ${error.message}`);
                }
            }

            // Teste 4: APIs e Backend
            async testarAPIs() {
                this.atualizarProgresso(80, "Testando APIs e backend...");
                const contentDiv = document.getElementById('content-apis');
                const statusDiv = document.getElementById('status-apis');
                
                contentDiv.innerHTML = '';

                const testesAPI = [
                    { endpoint: 'api/cartoes.php?request=estatisticas', nome: 'Estat√≠sticas de cart√µes' },
                    { endpoint: 'api/produtos.php?request=listar', nome: 'Listagem de produtos' }
                ];

                let apisOK = 0;
                let totalAPIs = testesAPI.length;

                for (const teste of testesAPI) {
                    try {
                        const response = await fetch(teste.endpoint);
                        if (response.ok) {
                            const data = await response.json();
                            this.adicionarResultadoDiv(contentDiv, 'success', `‚úÖ ${teste.nome} - OK`);
                            apisOK++;
                        } else {
                            this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå ${teste.nome} - Erro ${response.status}`);
                        }
                    } catch (error) {
                        this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå ${teste.nome} - ${error.message}`);
                    }
                }

                if (apisOK === totalAPIs) {
                    statusDiv.className = 'status-indicator status-success';
                    this.resultados.apis = { status: 'success', detalhes: 'Todas as APIs funcionando' };
                } else if (apisOK > 0) {
                    statusDiv.className = 'status-indicator status-warning';
                    this.resultados.apis = { status: 'warning', detalhes: `${apisOK}/${totalAPIs} APIs funcionando` };
                } else {
                    statusDiv.className = 'status-indicator status-error';
                    this.resultados.apis = { status: 'error', detalhes: 'Nenhuma API funcionando' };
                    this.problemasEncontrados.push('APIs n√£o est√£o respondendo');
                }
            }

            // Teste 5: Funcionalidades Frontend
            async testarFrontend() {
                this.atualizarProgresso(90, "Testando funcionalidades do frontend...");
                const contentDiv = document.getElementById('content-frontend');
                const statusDiv = document.getElementById('status-frontend');
                
                contentDiv.innerHTML = '';

                let testesPassaram = 0;
                let totalTestes = 0;

                // Testa se o gerenciador de cart√µes est√° dispon√≠vel
                totalTestes++;
                if (typeof window.gerenciadorCartao !== 'undefined' || typeof window.GerenciadorCartao !== 'undefined') {
                    this.adicionarResultadoDiv(contentDiv, 'success', '‚úÖ Gerenciador de cart√µes carregado');
                    testesPassaram++;
                } else {
                    this.adicionarResultadoDiv(contentDiv, 'error', '‚ùå Gerenciador de cart√µes n√£o encontrado');
                    this.problemasEncontrados.push('JavaScript do sistema de cart√µes n√£o est√° carregado');
                }

                // Testa fun√ß√µes globais essenciais
                const funcoesEssenciais = ['lerCartaoNFC', 'buscarCartao', 'recarregarCartao'];
                funcoesEssenciais.forEach(funcao => {
                    totalTestes++;
                    if (typeof window[funcao] === 'function') {
                        this.adicionarResultadoDiv(contentDiv, 'success', `‚úÖ Fun√ß√£o ${funcao} dispon√≠vel`);
                        testesPassaram++;
                    } else {
                        this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå Fun√ß√£o ${funcao} n√£o encontrada`);
                    }
                });

                // Testa localStorage se for a vers√£o localStorage
                if (this.versaoDetectada === 'localstorage') {
                    totalTestes++;
                    try {
                        // Testa cria√ß√£o de cart√£o fict√≠cio
                        const testCartao = {
                            numero: 'TEST001',
                            saldo: 10.00,
                            ativo: true
                        };
                        
                        localStorage.setItem('teste_caixaevent', JSON.stringify(testCartao));
                        const recuperado = JSON.parse(localStorage.getItem('teste_caixaevent'));
                        localStorage.removeItem('teste_caixaevent');
                        
                        if (recuperado && recuperado.numero === 'TEST001') {
                            this.adicionarResultadoDiv(contentDiv, 'success', '‚úÖ Opera√ß√µes localStorage funcionando');
                            testesPassaram++;
                        } else {
                            this.adicionarResultadoDiv(contentDiv, 'error', '‚ùå Problema nas opera√ß√µes localStorage');
                        }
                    } catch (error) {
                        this.adicionarResultadoDiv(contentDiv, 'error', `‚ùå Erro localStorage: ${error.message}`);
                    }
                }

                if (testesPassaram === totalTestes) {
                    statusDiv.className = 'status-indicator status-success';
                    this.resultados.frontend = { status: 'success', detalhes: 'Frontend funcionando perfeitamente' };
                } else if (testesPassaram > totalTestes / 2) {
                    statusDiv.className = 'status-indicator status-warning';
                    this.resultados.frontend = { status: 'warning', detalhes: `${testesPassaram}/${totalTestes} testes passaram` };
                } else {
                    statusDiv.className = 'status-indicator status-error';
                    this.resultados.frontend = { status: 'error', detalhes: 'Problemas cr√≠ticos no frontend' };
                    this.problemasEncontrados.push('Frontend com problemas cr√≠ticos');
                }
            }

            // Gera resumo final e recomenda√ß√µes
            gerarResumo() {
                const summaryGrid = document.getElementById('summaryGrid');
                const recommendations = document.getElementById('recommendations');
                
                summaryGrid.innerHTML = '';
                
                // Cards de resumo
                Object.entries(this.resultados).forEach(([categoria, resultado]) => {
                    const card = document.createElement('div');
                    card.className = `summary-card ${resultado.status}`;
                    
                    const icons = {
                        arquivos: 'üìÅ',
                        config: '‚öôÔ∏è',
                        mysql: 'üóÑÔ∏è',
                        apis: 'üåê',
                        frontend: 'üíª'
                    };
                    
                    card.innerHTML = `
                        <h3>${icons[categoria]} ${categoria.toUpperCase()}</h3>
                        <p><strong>Status:</strong> ${resultado.status}</p>
                        <p>${resultado.detalhes}</p>
                    `;
                    
                    summaryGrid.appendChild(card);
                });

                // Gera recomenda√ß√µes
                if (this.problemasEncontrados.length > 0) {
                    recommendations.innerHTML = `
                        <div class="fix-suggestion">
                            <h3>üîß Problemas Encontrados e Solu√ß√µes:</h3>
                            ${this.problemasEncontrados.map(problema => `
                                <div class="test-result result-error">‚ùå ${problema}</div>
                            `).join('')}
                            
                            <h4>üõ†Ô∏è Solu√ß√µes Recomendadas:</h4>
                            ${this.gerarSolucoes()}
                        </div>
                    `;
                } else {
                    recommendations.innerHTML = `
                        <div class="fix-suggestion">
                            <h3>üéâ Sistema Funcionando Perfeitamente!</h3>
                            <p>Todos os testes passaram com sucesso. O CaixaEvent v2.0 est√° funcionando corretamente.</p>
                        </div>
                    `;
                }
            }

            // Gera solu√ß√µes espec√≠ficas para os problemas encontrados
            gerarSolucoes() {
                const solucoes = [];

                if (this.problemasEncontrados.some(p => p.includes('Arquivos faltando'))) {
                    solucoes.push(`
                        <div class="test-result result-warning">
                            üìÅ <strong>Arquivos Faltando:</strong><br>
                            1. Verifique se todos os arquivos foram enviados para o servidor<br>
                            2. Confirme as permiss√µes de pasta<br>
                            3. Re-upload dos arquivos faltando
                        </div>
                    `);
                }

                if (this.problemasEncontrados.some(p => p.includes('MySQL'))) {
                    solucoes.push(`
                        <div class="test-result result-warning">
                            üóÑÔ∏è <strong>Problemas MySQL:</strong><br>
                            1. Verifique as credenciais no api/config.php<br>
                            2. Confirme se o IP do servidor est√° liberado<br>
                            3. Teste a conex√£o diretamente no phpMyAdmin<br>
                            <div class="code-block">
                                // Credenciais atuais no config.php:
                                Host: srv406.hstgr.io
                                DB: u383946504_sce
                                User: u383946504_sce
                                Pass: Aaku_2004@
                            </div>
                        </div>
                    `);
                }

                if (this.problemasEncontradas?.some(p => p.includes('Vers√£o do sistema n√£o detectada'))) {
                    solucoes.push(`
                        <div class="test-result result-warning">
                            üîÑ <strong>Vers√£o do Sistema:</strong><br>
                            Configure qual vers√£o usar no index.html:<br>
                            <div class="code-block">
                                <!-- Para localStorage (funciona offline): -->
                                &lt;script src="js/cartao.js"&gt;&lt;/script&gt;
                                
                                <!-- Para MySQL (necessita servidor): -->
                                &lt;script src="js/cartao-mysql.js"&gt;&lt;/script&gt;
                            </div>
                        </div>
                    `);
                }

                if (this.problemasEncontrados.some(p => p.includes('APIs n√£o est√£o respondendo'))) {
                    solucoes.push(`
                        <div class="test-result result-warning">
                            üåê <strong>APIs n√£o Funcionando:</strong><br>
                            1. Verifique se o PHP est√° habilitado no servidor<br>
                            2. Confirme se as extens√µes PDO e MySQL est√£o ativas<br>
                            3. Teste acessando api/config.php diretamente<br>
                            4. Considere usar a vers√£o localStorage temporariamente
                        </div>
                    `);
                }

                return solucoes.join('');
            }

            // Corre√ß√£o autom√°tica de problemas
            async corrigirProblemasAutomaticamente() {
                if (this.problemasEncontrados.length === 0) {
                    alert('‚úÖ Nenhum problema detectado! Sistema funcionando normalmente.');
                    return;
                }

                if (confirm('üîß Deseja tentar a corre√ß√£o autom√°tica dos problemas encontrados?')) {
                    // Se n√£o h√° vers√£o detectada, sugere configurar para localStorage
                    if (this.versaoDetectada === 'indefinida') {
                        await this.configurarVersaoLocalStorage();
                    }

                    // Se h√° problemas MySQL mas vers√£o √© localStorage, ignora
                    if (this.versaoDetectada === 'localstorage' && this.problemasEncontrados.some(p => p.includes('MySQL'))) {
                        alert('üíæ Sistema configurado para localStorage - problemas MySQL ignorados.');
                    }

                    alert('üîß Corre√ß√µes aplicadas! Execute o debug novamente para verificar.');
                }
            }

            // Configura automaticamente para vers√£o localStorage
            async configurarVersaoLocalStorage() {
                try {
                    const response = await fetch('index.html');
                    let html = await response.text();
                    
                    // Remove refer√™ncia ao cartao-mysql.js se existir
                    html = html.replace(/src="js\/cartao-mysql\.js"/g, 'src="js/cartao.js"');
                    
                    // Se n√£o h√° nenhuma refer√™ncia, adiciona
                    if (!html.includes('cartao.js') && !html.includes('cartao-mysql.js')) {
                        html = html.replace('</body>', "<script src=\"js/cartao.js\"></script>\n</body>");
                    }
                    
                    console.log('HTML configurado para localStorage');
                    this.versaoDetectada = 'localstorage';
                } catch (error) {
                    console.error('Erro ao configurar localStorage:', error);
                }
            }

            // Func√µes auxiliares
            atualizarProgresso(percentual, texto) {
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                progressFill.style.width = percentual + '%';
                progressText.textContent = texto;
            }

            adicionarResultadoDiv(container, tipo, mensagem) {
                const div = document.createElement('div');
                div.className = `test-result result-${tipo}`;
                div.textContent = mensagem;
                container.appendChild(div);
            }

            // Testes individuais que podem ser chamados separadamente
            async testarConexoesBanco() {
                await this.testarMySQL();
            }

            async testarFuncionalidades() {
                await this.testarFrontend();
            }
        }

        // Instancia o sistema de debug
        const debugSystem = new DebugCaixaEvent();

        // Fun√ß√µes globais para os bot√µes
        window.iniciarDebugCompleto = () => debugSystem.iniciarDebugCompleto();
        window.testarConexoesBanco = () => debugSystem.testarConexoesBanco();
        window.testarFuncionalidades = () => debugSystem.testarFuncionalidades();
        window.corrigirProblemasAutomaticamente = () => debugSystem.corrigirProblemasAutomaticamente();

        // Auto-executa o debug quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Sistema de Debug CaixaEvent v2.0 carregado!');
            
            // Executa debug autom√°tico ap√≥s 2 segundos
            setTimeout(() => {
                if (confirm('üöÄ Executar diagn√≥stico autom√°tico do sistema?')) {
                    debugSystem.iniciarDebugCompleto();
                }
            }, 2000);
        });
    </script>
</body>
</html>